<html lang="en" class="navy" dir="ltr"><head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Inline assembly - The Rust Reference</title>


    <!-- Custom HTML head -->
    
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="rgb(22, 25, 35)">

    <link rel="icon" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
    <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css" disabled="">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css" disabled="">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="theme/reference.css">

</head>
<body class="js sidebar-hidden">
<div id="body-container">
    <!-- Provide site root to javascript -->
    <script>
        var path_to_root = "";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script>
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');

            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }

            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script>
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('light')
        html.classList.add(theme);
        var body = document.querySelector('body');
        body.classList.remove('no-js')
        body.classList.add('js');
    </script>

    <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

    <!-- Hide / unhide sidebar before it is displayed -->
    <script>
        var body = document.querySelector('body');
        var sidebar = null;
        var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
            sidebar = sidebar || 'visible';
        } else {
            sidebar = 'hidden';
        }
        sidebar_toggle.checked = sidebar === 'visible';
        body.classList.remove('sidebar-visible');
        body.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents" aria-hidden="true">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html" tabindex="-1">Introduction</a></li><li class="chapter-item expanded "><a href="notation.html" tabindex="-1"><strong aria-hidden="true">1.</strong> Notation</a></li><li class="chapter-item expanded "><a href="lexical-structure.html" tabindex="-1"><strong aria-hidden="true">2.</strong> Lexical structure</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="input-format.html" tabindex="-1"><strong aria-hidden="true">2.1.</strong> Input format</a></li><li class="chapter-item expanded "><a href="keywords.html" tabindex="-1"><strong aria-hidden="true">2.2.</strong> Keywords</a></li><li class="chapter-item expanded "><a href="identifiers.html" tabindex="-1"><strong aria-hidden="true">2.3.</strong> Identifiers</a></li><li class="chapter-item expanded "><a href="comments.html" tabindex="-1"><strong aria-hidden="true">2.4.</strong> Comments</a></li><li class="chapter-item expanded "><a href="whitespace.html" tabindex="-1"><strong aria-hidden="true">2.5.</strong> Whitespace</a></li><li class="chapter-item expanded "><a href="tokens.html" tabindex="-1"><strong aria-hidden="true">2.6.</strong> Tokens</a></li></ol></li><li class="chapter-item expanded "><a href="macros.html" tabindex="-1"><strong aria-hidden="true">3.</strong> Macros</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="macros-by-example.html" tabindex="-1"><strong aria-hidden="true">3.1.</strong> Macros By Example</a></li><li class="chapter-item expanded "><a href="procedural-macros.html" tabindex="-1"><strong aria-hidden="true">3.2.</strong> Procedural Macros</a></li></ol></li><li class="chapter-item expanded "><a href="crates-and-source-files.html" tabindex="-1"><strong aria-hidden="true">4.</strong> Crates and source files</a></li><li class="chapter-item expanded "><a href="conditional-compilation.html" tabindex="-1"><strong aria-hidden="true">5.</strong> Conditional compilation</a></li><li class="chapter-item expanded "><a href="items.html" tabindex="-1"><strong aria-hidden="true">6.</strong> Items</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="items/modules.html" tabindex="-1"><strong aria-hidden="true">6.1.</strong> Modules</a></li><li class="chapter-item expanded "><a href="items/extern-crates.html" tabindex="-1"><strong aria-hidden="true">6.2.</strong> Extern crates</a></li><li class="chapter-item expanded "><a href="items/use-declarations.html" tabindex="-1"><strong aria-hidden="true">6.3.</strong> Use declarations</a></li><li class="chapter-item expanded "><a href="items/functions.html" tabindex="-1"><strong aria-hidden="true">6.4.</strong> Functions</a></li><li class="chapter-item expanded "><a href="items/type-aliases.html" tabindex="-1"><strong aria-hidden="true">6.5.</strong> Type aliases</a></li><li class="chapter-item expanded "><a href="items/structs.html" tabindex="-1"><strong aria-hidden="true">6.6.</strong> Structs</a></li><li class="chapter-item expanded "><a href="items/enumerations.html" tabindex="-1"><strong aria-hidden="true">6.7.</strong> Enumerations</a></li><li class="chapter-item expanded "><a href="items/unions.html" tabindex="-1"><strong aria-hidden="true">6.8.</strong> Unions</a></li><li class="chapter-item expanded "><a href="items/constant-items.html" tabindex="-1"><strong aria-hidden="true">6.9.</strong> Constant items</a></li><li class="chapter-item expanded "><a href="items/static-items.html" tabindex="-1"><strong aria-hidden="true">6.10.</strong> Static items</a></li><li class="chapter-item expanded "><a href="items/traits.html" tabindex="-1"><strong aria-hidden="true">6.11.</strong> Traits</a></li><li class="chapter-item expanded "><a href="items/implementations.html" tabindex="-1"><strong aria-hidden="true">6.12.</strong> Implementations</a></li><li class="chapter-item expanded "><a href="items/external-blocks.html" tabindex="-1"><strong aria-hidden="true">6.13.</strong> External blocks</a></li><li class="chapter-item expanded "><a href="items/generics.html" tabindex="-1"><strong aria-hidden="true">6.14.</strong> Generic parameters</a></li><li class="chapter-item expanded "><a href="items/associated-items.html" tabindex="-1"><strong aria-hidden="true">6.15.</strong> Associated Items</a></li></ol></li><li class="chapter-item expanded "><a href="attributes.html" tabindex="-1"><strong aria-hidden="true">7.</strong> Attributes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="attributes/testing.html" tabindex="-1"><strong aria-hidden="true">7.1.</strong> Testing</a></li><li class="chapter-item expanded "><a href="attributes/derive.html" tabindex="-1"><strong aria-hidden="true">7.2.</strong> Derive</a></li><li class="chapter-item expanded "><a href="attributes/diagnostics.html" tabindex="-1"><strong aria-hidden="true">7.3.</strong> Diagnostics</a></li><li class="chapter-item expanded "><a href="attributes/codegen.html" tabindex="-1"><strong aria-hidden="true">7.4.</strong> Code generation</a></li><li class="chapter-item expanded "><a href="attributes/limits.html" tabindex="-1"><strong aria-hidden="true">7.5.</strong> Limits</a></li><li class="chapter-item expanded "><a href="attributes/type_system.html" tabindex="-1"><strong aria-hidden="true">7.6.</strong> Type System</a></li><li class="chapter-item expanded "><a href="attributes/debugger.html" tabindex="-1"><strong aria-hidden="true">7.7.</strong> Debugger</a></li></ol></li><li class="chapter-item expanded "><a href="statements-and-expressions.html" tabindex="-1"><strong aria-hidden="true">8.</strong> Statements and expressions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="statements.html" tabindex="-1"><strong aria-hidden="true">8.1.</strong> Statements</a></li><li class="chapter-item expanded "><a href="expressions.html" tabindex="-1"><strong aria-hidden="true">8.2.</strong> Expressions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="expressions/literal-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.1.</strong> Literal expressions</a></li><li class="chapter-item expanded "><a href="expressions/path-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.2.</strong> Path expressions</a></li><li class="chapter-item expanded "><a href="expressions/block-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.3.</strong> Block expressions</a></li><li class="chapter-item expanded "><a href="expressions/operator-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.4.</strong> Operator expressions</a></li><li class="chapter-item expanded "><a href="expressions/grouped-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.5.</strong> Grouped expressions</a></li><li class="chapter-item expanded "><a href="expressions/array-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.6.</strong> Array and index expressions</a></li><li class="chapter-item expanded "><a href="expressions/tuple-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.7.</strong> Tuple and index expressions</a></li><li class="chapter-item expanded "><a href="expressions/struct-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.8.</strong> Struct expressions</a></li><li class="chapter-item expanded "><a href="expressions/call-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.9.</strong> Call expressions</a></li><li class="chapter-item expanded "><a href="expressions/method-call-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.10.</strong> Method call expressions</a></li><li class="chapter-item expanded "><a href="expressions/field-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.11.</strong> Field access expressions</a></li><li class="chapter-item expanded "><a href="expressions/closure-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.12.</strong> Closure expressions</a></li><li class="chapter-item expanded "><a href="expressions/loop-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.13.</strong> Loop expressions</a></li><li class="chapter-item expanded "><a href="expressions/range-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.14.</strong> Range expressions</a></li><li class="chapter-item expanded "><a href="expressions/if-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.15.</strong> If and if let expressions</a></li><li class="chapter-item expanded "><a href="expressions/match-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.16.</strong> Match expressions</a></li><li class="chapter-item expanded "><a href="expressions/return-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.17.</strong> Return expressions</a></li><li class="chapter-item expanded "><a href="expressions/await-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.18.</strong> Await expressions</a></li><li class="chapter-item expanded "><a href="expressions/underscore-expr.html" tabindex="-1"><strong aria-hidden="true">8.2.19.</strong> Underscore expressions</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="patterns.html" tabindex="-1"><strong aria-hidden="true">9.</strong> Patterns</a></li><li class="chapter-item expanded "><a href="type-system.html" tabindex="-1"><strong aria-hidden="true">10.</strong> Type system</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="types.html" tabindex="-1"><strong aria-hidden="true">10.1.</strong> Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="types/boolean.html" tabindex="-1"><strong aria-hidden="true">10.1.1.</strong> Boolean type</a></li><li class="chapter-item expanded "><a href="types/numeric.html" tabindex="-1"><strong aria-hidden="true">10.1.2.</strong> Numeric types</a></li><li class="chapter-item expanded "><a href="types/textual.html" tabindex="-1"><strong aria-hidden="true">10.1.3.</strong> Textual types</a></li><li class="chapter-item expanded "><a href="types/never.html" tabindex="-1"><strong aria-hidden="true">10.1.4.</strong> Never type</a></li><li class="chapter-item expanded "><a href="types/tuple.html" tabindex="-1"><strong aria-hidden="true">10.1.5.</strong> Tuple types</a></li><li class="chapter-item expanded "><a href="types/array.html" tabindex="-1"><strong aria-hidden="true">10.1.6.</strong> Array types</a></li><li class="chapter-item expanded "><a href="types/slice.html" tabindex="-1"><strong aria-hidden="true">10.1.7.</strong> Slice types</a></li><li class="chapter-item expanded "><a href="types/struct.html" tabindex="-1"><strong aria-hidden="true">10.1.8.</strong> Struct types</a></li><li class="chapter-item expanded "><a href="types/enum.html" tabindex="-1"><strong aria-hidden="true">10.1.9.</strong> Enumerated types</a></li><li class="chapter-item expanded "><a href="types/union.html" tabindex="-1"><strong aria-hidden="true">10.1.10.</strong> Union types</a></li><li class="chapter-item expanded "><a href="types/function-item.html" tabindex="-1"><strong aria-hidden="true">10.1.11.</strong> Function item types</a></li><li class="chapter-item expanded "><a href="types/closure.html" tabindex="-1"><strong aria-hidden="true">10.1.12.</strong> Closure types</a></li><li class="chapter-item expanded "><a href="types/pointer.html" tabindex="-1"><strong aria-hidden="true">10.1.13.</strong> Pointer types</a></li><li class="chapter-item expanded "><a href="types/function-pointer.html" tabindex="-1"><strong aria-hidden="true">10.1.14.</strong> Function pointer types</a></li><li class="chapter-item expanded "><a href="types/trait-object.html" tabindex="-1"><strong aria-hidden="true">10.1.15.</strong> Trait object types</a></li><li class="chapter-item expanded "><a href="types/impl-trait.html" tabindex="-1"><strong aria-hidden="true">10.1.16.</strong> Impl trait type</a></li><li class="chapter-item expanded "><a href="types/parameters.html" tabindex="-1"><strong aria-hidden="true">10.1.17.</strong> Type parameters</a></li><li class="chapter-item expanded "><a href="types/inferred.html" tabindex="-1"><strong aria-hidden="true">10.1.18.</strong> Inferred type</a></li></ol></li><li class="chapter-item expanded "><a href="dynamically-sized-types.html" tabindex="-1"><strong aria-hidden="true">10.2.</strong> Dynamically Sized Types</a></li><li class="chapter-item expanded "><a href="type-layout.html" tabindex="-1"><strong aria-hidden="true">10.3.</strong> Type layout</a></li><li class="chapter-item expanded "><a href="interior-mutability.html" tabindex="-1"><strong aria-hidden="true">10.4.</strong> Interior mutability</a></li><li class="chapter-item expanded "><a href="subtyping.html" tabindex="-1"><strong aria-hidden="true">10.5.</strong> Subtyping and Variance</a></li><li class="chapter-item expanded "><a href="trait-bounds.html" tabindex="-1"><strong aria-hidden="true">10.6.</strong> Trait and lifetime bounds</a></li><li class="chapter-item expanded "><a href="type-coercions.html" tabindex="-1"><strong aria-hidden="true">10.7.</strong> Type coercions</a></li><li class="chapter-item expanded "><a href="destructors.html" tabindex="-1"><strong aria-hidden="true">10.8.</strong> Destructors</a></li><li class="chapter-item expanded "><a href="lifetime-elision.html" tabindex="-1"><strong aria-hidden="true">10.9.</strong> Lifetime elision</a></li></ol></li><li class="chapter-item expanded "><a href="special-types-and-traits.html" tabindex="-1"><strong aria-hidden="true">11.</strong> Special types and traits</a></li><li class="chapter-item expanded "><a href="names.html" tabindex="-1"><strong aria-hidden="true">12.</strong> Names</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="names/namespaces.html" tabindex="-1"><strong aria-hidden="true">12.1.</strong> Namespaces</a></li><li class="chapter-item expanded "><a href="names/scopes.html" tabindex="-1"><strong aria-hidden="true">12.2.</strong> Scopes</a></li><li class="chapter-item expanded "><a href="names/preludes.html" tabindex="-1"><strong aria-hidden="true">12.3.</strong> Preludes</a></li><li class="chapter-item expanded "><a href="paths.html" tabindex="-1"><strong aria-hidden="true">12.4.</strong> Paths</a></li><li class="chapter-item expanded "><a href="names/name-resolution.html" tabindex="-1"><strong aria-hidden="true">12.5.</strong> Name resolution</a></li><li class="chapter-item expanded "><a href="visibility-and-privacy.html" tabindex="-1"><strong aria-hidden="true">12.6.</strong> Visibility and privacy</a></li></ol></li><li class="chapter-item expanded "><a href="memory-model.html" tabindex="-1"><strong aria-hidden="true">13.</strong> Memory model</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="memory-allocation-and-lifetime.html" tabindex="-1"><strong aria-hidden="true">13.1.</strong> Memory allocation and lifetime</a></li><li class="chapter-item expanded "><a href="variables.html" tabindex="-1"><strong aria-hidden="true">13.2.</strong> Variables</a></li></ol></li><li class="chapter-item expanded "><a href="linkage.html" tabindex="-1"><strong aria-hidden="true">14.</strong> Linkage</a></li><li class="chapter-item expanded "><a href="inline-assembly.html" class="active" tabindex="-1"><strong aria-hidden="true">15.</strong> Inline assembly</a></li><li class="chapter-item expanded "><a href="unsafety.html" tabindex="-1"><strong aria-hidden="true">16.</strong> Unsafety</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="unsafe-keyword.html" tabindex="-1"><strong aria-hidden="true">16.1.</strong> The unsafe keyword</a></li><li class="chapter-item expanded "><a href="behavior-considered-undefined.html" tabindex="-1"><strong aria-hidden="true">16.2.</strong> Behavior considered undefined</a></li><li class="chapter-item expanded "><a href="behavior-not-considered-unsafe.html" tabindex="-1"><strong aria-hidden="true">16.3.</strong> Behavior not considered unsafe</a></li></ol></li><li class="chapter-item expanded "><a href="const_eval.html" tabindex="-1"><strong aria-hidden="true">17.</strong> Constant Evaluation</a></li><li class="chapter-item expanded "><a href="abi.html" tabindex="-1"><strong aria-hidden="true">18.</strong> Application Binary Interface</a></li><li class="chapter-item expanded "><a href="runtime.html" tabindex="-1"><strong aria-hidden="true">19.</strong> The Rust runtime</a></li><li class="chapter-item expanded "><a href="appendices.html" tabindex="-1"><strong aria-hidden="true">20.</strong> Appendices</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="macro-ambiguity.html" tabindex="-1"><strong aria-hidden="true">20.1.</strong> Macro Follow-Set Ambiguity Formal Specification</a></li><li class="chapter-item expanded "><a href="influences.html" tabindex="-1"><strong aria-hidden="true">20.2.</strong> Influences</a></li><li class="chapter-item expanded "><a href="glossary.html" tabindex="-1"><strong aria-hidden="true">20.3.</strong> Glossary</a></li></ol></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle">
            <div class="sidebar-resize-indicator"></div>
        </div>
    </nav>

    <!-- Track and set sidebar scroll position -->
    <script>
        var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
        sidebarScrollbox.addEventListener('click', function(e) {
            if (e.target.tagName === 'A') {
                sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
            }
        }, { passive: true });
        var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
        sessionStorage.removeItem('sidebar-scroll');
        if (sidebarScrollTop) {
            // preserve sidebar scroll position when navigating via links within sidebar
            sidebarScrollbox.scrollTop = sidebarScrollTop;
        } else {
            // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
            var activeSection = document.querySelector('#sidebar .active');
            if (activeSection) {
                activeSection.scrollIntoView({ block: 'center' });
            }
        }
    </script>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
                            <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar bordered" style="top: 15981.6px;">
                <div class="left-buttons">
                    <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar" aria-expanded="false">
                        <i class="fa fa-bars"></i>
                    </label>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme theme-selected" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">The Rust Reference</h1>

                <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/rust-lang/reference/" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    <a href="https://github.com/rust-lang/reference/edit/master/src/inline-assembly.md" title="Suggest an edit" aria-label="Suggest an edit">
                        <i id="git-edit-button" class="fa fa-edit"></i>
                    </a>

                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script>
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <main>
                    <h1 id="inline-assembly"><a class="header" href="#inline-assembly">Inline assembly</a></h1>
<div class="rule" id="asm"><a class="rule-link" href="#asm">[asm]</a></div>
<div class="rule" id="asm.intro"><a class="rule-link" href="#asm.intro">[asm.intro]</a></div>
<p>Support for inline assembly is provided via the <a href="../core/arch/macro.asm.html"><code class="hljs">asm!</code></a> and <a href="../core/arch/macro.global_asm.html"><code class="hljs">global_asm!</code></a> macros.
It can be used to embed handwritten assembly in the assembly output generated by the compiler.</p>
<div class="rule" id="asm.stable-targets"><a class="rule-link" href="#asm.stable-targets">[asm.stable-targets]</a></div>
<p>Support for inline assembly is stable on the following architectures:</p>
<ul>
<li>x86 and x86-64</li>
<li>ARM</li>
<li>AArch64</li>
<li>RISC-V</li>
<li>LoongArch</li>
</ul>
<p>The compiler will emit an error if <code class="hljs">asm!</code> is used on an unsupported target.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<div class="rule" id="asm.example"><a class="rule-link" href="#asm.example">[asm.example]</a></div>
<pre><pre class="playground"><div class="buttons"><button class="fa fa-copy clip-button" title="Copy to clipboard" aria-label="Copy to clipboard"><i class="tooltiptext"></i></button><button class="fa fa-play play-button" hidden="" title="Run this code" aria-label="Run this code"></button><button class="fa fa-eye" title="Show hidden lines" aria-label="Show hidden lines"></button></div><code class="language-rust edition2021 hljs hide-boring"><span class="boring"><span class="hljs-meta">#![allow(unused)]</span>
</span><span class="boring"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
</span><span class="boring"><span class="hljs-meta">#[cfg(target_arch = <span class="hljs-meta-string">"x86_64"</span>)]</span> {
</span><span class="hljs-keyword">use</span> std::arch::asm;

<span class="hljs-comment">// Multiply x by 6 using shifts and adds</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> x: <span class="hljs-built_in">u64</span> = <span class="hljs-number">4</span>;
<span class="hljs-keyword">unsafe</span> {
asm!(
    <span class="hljs-string">"mov {tmp}, {x}"</span>,
    <span class="hljs-string">"shl {tmp}, 1"</span>,
    <span class="hljs-string">"shl {x}, 2"</span>,
    <span class="hljs-string">"add {x}, {tmp}"</span>,
    x = inout(reg) x,
    tmp = out(reg) _,
);
}
<span class="hljs-built_in">assert_eq!</span>(x, <span class="hljs-number">4</span> * <span class="hljs-number">6</span>);
<span class="boring">}
</span><span class="boring">}</span></code></pre></pre>
<h2 id="syntax"><a class="header" href="#syntax">Syntax</a></h2>
<div class="rule" id="asm.syntax"><a class="rule-link" href="#asm.syntax">[asm.syntax]</a></div>
<p>The following ABNF specifies the general syntax:</p>
<pre><div class="buttons"><button class="fa fa-copy clip-button" title="Copy to clipboard" aria-label="Copy to clipboard"><i class="tooltiptext"></i></button></div><code class="language-text hljs plaintext">format_string := STRING_LITERAL / RAW_STRING_LITERAL
dir_spec := "in" / "out" / "lateout" / "inout" / "inlateout"
reg_spec := &lt;register class&gt; / "\"" &lt;explicit register&gt; "\""
operand_expr := expr / "_" / expr "=&gt;" expr / expr "=&gt;" "_"
reg_operand := [ident "="] dir_spec "(" reg_spec ")" operand_expr / sym &lt;path&gt; / const &lt;expr&gt;
clobber_abi := "clobber_abi(" &lt;abi&gt; *("," &lt;abi&gt;) [","] ")"
option := "pure" / "nomem" / "readonly" / "preserves_flags" / "noreturn" / "nostack" / "att_syntax" / "raw"
options := "options(" option *("," option) [","] ")"
operand := reg_operand / clobber_abi / options
asm := "asm!(" format_string *("," format_string) *("," operand) [","] ")"
global_asm := "global_asm!(" format_string *("," format_string) *("," operand) [","] ")"
</code></pre>
<h2 id="scope"><a class="header" href="#scope">Scope</a></h2>
<div class="rule" id="asm.scope"><a class="rule-link" href="#asm.scope">[asm.scope]</a></div>
<div class="rule" id="asm.scope.intro"><a class="rule-link" href="#asm.scope.intro">[asm.scope.intro]</a></div>
<p>Inline assembly can be used in one of two ways.</p>
<div class="rule" id="asm.scope.asm"><a class="rule-link" href="#asm.scope.asm">[asm.scope.asm]</a></div>
<p>With the <code class="hljs">asm!</code> macro, the assembly code is emitted in a function scope and integrated into the compiler-generated assembly code of a function.
This assembly code must obey <a href="#rules-for-inline-assembly">strict rules</a> to avoid undefined behavior.
Note that in some cases the compiler may choose to emit the assembly code as a separate function and generate a call to it.</p>
<div class="rule" id="asm.scope.global_asm"><a class="rule-link" href="#asm.scope.global_asm">[asm.scope.global_asm]</a></div>
<p>With the <code class="hljs">global_asm!</code> macro, the assembly code is emitted in a global scope, outside a function.
This can be used to hand-write entire functions using assembly code, and generally provides much more freedom to use arbitrary registers and assembler directives.</p>
<h2 id="template-string-arguments"><a class="header" href="#template-string-arguments">Template string arguments</a></h2>
<div class="rule" id="asm.ts-args"><a class="rule-link" href="#asm.ts-args">[asm.ts-args]</a></div>
<div class="rule" id="asm.ts-args.syntax"><a class="rule-link" href="#asm.ts-args.syntax">[asm.ts-args.syntax]</a></div>
<p>The assembler template uses the same syntax as <a href="../alloc/fmt/index.html#syntax">format strings</a> (i.e. placeholders are specified by curly braces).</p>
<div class="rule" id="asm.ts-args.order"><a class="rule-link" href="#asm.ts-args.order">[asm.ts-args.order]</a></div>
<p>The corresponding arguments are accessed in order, by index, or by name.</p>
<div class="rule" id="asm.ts-args.no-implicit"><a class="rule-link" href="#asm.ts-args.no-implicit">[asm.ts-args.no-implicit]</a></div>
<p>However, implicit named arguments (introduced by <a href="https://github.com/rust-lang/rfcs/pull/2795">RFC #2795</a>) are not supported.</p>
<div class="rule" id="asm.ts-args.one-or-more"><a class="rule-link" href="#asm.ts-args.one-or-more">[asm.ts-args.one-or-more]</a></div>
<p>An <code class="hljs">asm!</code> invocation may have one or more template string arguments; an <code class="hljs">asm!</code> with multiple template string arguments is treated as if all the strings were concatenated with a <code class="hljs">\n</code> between them.
The expected usage is for each template string argument to correspond to a line of assembly code.</p>
<div class="rule" id="asm.ts-args.before-other-args"><a class="rule-link" href="#asm.ts-args.before-other-args">[asm.ts-args.before-other-args]</a></div>
<p>All template string arguments must appear before any other arguments.</p>
<div class="rule" id="asm.ts-args.positional-first"><a class="rule-link" href="#asm.ts-args.positional-first">[asm.ts-args.positional-first]</a></div>
<p>As with format strings, positional arguments must appear before named arguments and explicit <a href="#register-operands">register operands</a>.</p>
<div class="rule" id="asm.ts-args.register-operands"><a class="rule-link" href="#asm.ts-args.register-operands">[asm.ts-args.register-operands]</a></div>
<p>Explicit register operands cannot be used by placeholders in the template string.</p>
<div class="rule" id="asm.ts-args.at-least-once"><a class="rule-link" href="#asm.ts-args.at-least-once">[asm.ts-args.at-least-once]</a></div>
<p>All other named and positional operands must appear at least once in the template string, otherwise a compiler error is generated.</p>
<div class="rule" id="asm.ts-args.opaque"><a class="rule-link" href="#asm.ts-args.opaque">[asm.ts-args.opaque]</a></div>
<p>The exact assembly code syntax is target-specific and opaque to the compiler except for the way operands are substituted into the template string to form the code passed to the assembler.</p>
<div class="rule" id="asm.ts-args.llvm-syntax"><a class="rule-link" href="#asm.ts-args.llvm-syntax">[asm.ts-args.llvm-syntax]</a></div>
<p>Currently, all supported targets follow the assembly code syntax used by LLVMâ€™s internal assembler which usually corresponds to that of the GNU assembler (GAS).
On x86, the <code class="hljs">.intel_syntax noprefix</code> mode of GAS is used by default.
On ARM, the <code class="hljs">.syntax unified</code> mode is used.
These targets impose an additional restriction on the assembly code: any assembler state (e.g. the current section which can be changed with <code class="hljs">.section</code>) must be restored to its original value at the end of the asm string.
Assembly code that does not conform to the GAS syntax will result in assembler-specific behavior.
Further constraints on the directives used by inline assembly are indicated by <a href="#directives-support">Directives Support</a>.</p>
<h2 id="operand-type"><a class="header" href="#operand-type">Operand type</a></h2>
<div class="rule" id="asm.operand-type"><a class="rule-link" href="#asm.operand-type">[asm.operand-type]</a></div>
<div class="rule" id="asm.operand-type.supported-operands"><a class="rule-link" href="#asm.operand-type.supported-operands">[asm.operand-type.supported-operands]</a></div>
<p>Several types of operands are supported:</p>
<div class="rule" id="asm.operand-type.supported-operands.in"><a class="rule-link" href="#asm.operand-type.supported-operands.in">[asm.operand-type.supported-operands.in]</a></div>
<ul>
<li><code class="hljs">in(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li><code class="hljs">&lt;reg&gt;</code> can refer to a register class or an explicit register.
The allocated register name is substituted into the asm template string.</li>
<li>The allocated register will contain the value of <code class="hljs">&lt;expr&gt;</code> at the start of the asm code.</li>
<li>The allocated register must contain the same value at the end of the asm code (except if a <code class="hljs">lateout</code> is allocated to the same register).</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.operand-type.supported-operands.out"><a class="rule-link" href="#asm.operand-type.supported-operands.out">[asm.operand-type.supported-operands.out]</a></div>
<ul>
<li><code class="hljs">out(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li><code class="hljs">&lt;reg&gt;</code> can refer to a register class or an explicit register.
The allocated register name is substituted into the asm template string.</li>
<li>The allocated register will contain an undefined value at the start of the asm code.</li>
<li><code class="hljs">&lt;expr&gt;</code> must be a (possibly uninitialized) place expression, to which the contents of the allocated register are written at the end of the asm code.</li>
<li>An underscore (<code class="hljs">_</code>) may be specified instead of an expression, which will cause the contents of the register to be discarded at the end of the asm code (effectively acting as a clobber).</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.operand-type.supported-operands.lateout"><a class="rule-link" href="#asm.operand-type.supported-operands.lateout">[asm.operand-type.supported-operands.lateout]</a></div>
<ul>
<li><code class="hljs">lateout(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li>Identical to <code class="hljs">out</code> except that the register allocator can reuse a register allocated to an <code class="hljs">in</code>.</li>
<li>You should only write to the register after all <mark data-markjs="true">input</mark>s are read, otherwise you may clobber an <mark data-markjs="true">input</mark>.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.operand-type.supported-operands.inout"><a class="rule-link" href="#asm.operand-type.supported-operands.inout">[asm.operand-type.supported-operands.inout]</a></div>
<ul>
<li><code class="hljs">inout(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li><code class="hljs">&lt;reg&gt;</code> can refer to a register class or an explicit register.
The allocated register name is substituted into the asm template string.</li>
<li>The allocated register will contain the value of <code class="hljs">&lt;expr&gt;</code> at the start of the asm code.</li>
<li><code class="hljs">&lt;expr&gt;</code> must be a mutable initialized place expression, to which the contents of the allocated register are written at the end of the asm code.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.operand-type.supported-operands.inout-arrow"><a class="rule-link" href="#asm.operand-type.supported-operands.inout-arrow">[asm.operand-type.supported-operands.inout-arrow]</a></div>
<ul>
<li><code class="hljs">inout(&lt;reg&gt;) &lt;in expr&gt; =&gt; &lt;out expr&gt;</code>
<ul>
<li>Same as <code class="hljs">inout</code> except that the initial value of the register is taken from the value of <code class="hljs">&lt;in expr&gt;</code>.</li>
<li><code class="hljs">&lt;out expr&gt;</code> must be a (possibly uninitialized) place expression, to which the contents of the allocated register are written at the end of the asm code.</li>
<li>An underscore (<code class="hljs">_</code>) may be specified instead of an expression for <code class="hljs">&lt;out expr&gt;</code>, which will cause the contents of the register to be discarded at the end of the asm code (effectively acting as a clobber).</li>
<li><code class="hljs">&lt;in expr&gt;</code> and <code class="hljs">&lt;out expr&gt;</code> may have different types.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.operand-type.supported-operands.inlateout"><a class="rule-link" href="#asm.operand-type.supported-operands.inlateout">[asm.operand-type.supported-operands.inlateout]</a></div>
<ul>
<li><code class="hljs">inlateout(&lt;reg&gt;) &lt;expr&gt;</code> / <code class="hljs">inlateout(&lt;reg&gt;) &lt;in expr&gt; =&gt; &lt;out expr&gt;</code>
<ul>
<li>Identical to <code class="hljs">inout</code> except that the register allocator can reuse a register allocated to an <code class="hljs">in</code> (this can happen if the compiler knows the <code class="hljs">in</code> has the same initial value as the <code class="hljs">inlateout</code>).</li>
<li>You should only write to the register after all <mark data-markjs="true">input</mark>s are read, otherwise you may clobber an <mark data-markjs="true">input</mark>.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.operand-type.supported-operands.sym"><a class="rule-link" href="#asm.operand-type.supported-operands.sym">[asm.operand-type.supported-operands.sym]</a></div>
<ul>
<li><code class="hljs">sym &lt;path&gt;</code>
<ul>
<li><code class="hljs">&lt;path&gt;</code> must refer to a <code class="hljs">fn</code> or <code class="hljs">static</code>.</li>
<li>A mangled symbol name referring to the item is substituted into the asm template string.</li>
<li>The substituted string does not include any modifiers (e.g. GOT, PLT, relocations, etc).</li>
<li><code class="hljs">&lt;path&gt;</code> is allowed to point to a <code class="hljs">#[thread_local]</code> static, in which case the asm code can combine the symbol with relocations (e.g. <code class="hljs">@plt</code>, <code class="hljs">@TPOFF</code>) to read from thread-local data.</li>
</ul>
</li>
<li><code class="hljs">const &lt;expr&gt;</code>
<ul>
<li><code class="hljs">&lt;expr&gt;</code> must be an integer constant expression. This expression follows the same rules as inline <code class="hljs">const</code> blocks.</li>
<li>The type of the expression may be any integer type, but defaults to <code class="hljs">i32</code> just like integer literals.</li>
<li>The value of the expression is formatted as a string and substituted directly into the asm template string.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.operand-type.left-to-right"><a class="rule-link" href="#asm.operand-type.left-to-right">[asm.operand-type.left-to-right]</a></div>
<p>Operand expressions are evaluated from left to right, just like function call arguments.
After the <code class="hljs">asm!</code> has executed, outputs are written to in left to right order.
This is significant if two outputs point to the same place: that place will contain the value of the rightmost output.</p>
<div class="rule" id="asm.operand-type.global_asm-restriction"><a class="rule-link" href="#asm.operand-type.global_asm-restriction">[asm.operand-type.global_asm-restriction]</a></div>
<p>Since <code class="hljs">global_asm!</code> exists outside a function, it can only use <code class="hljs">sym</code> and <code class="hljs">const</code> operands.</p>
<h2 id="register-operands"><a class="header" href="#register-operands">Register operands</a></h2>
<div class="rule" id="asm.register-operands"><a class="rule-link" href="#asm.register-operands">[asm.register-operands]</a></div>
<div class="rule" id="asm.register-operands.register-or-class"><a class="rule-link" href="#asm.register-operands.register-or-class">[asm.register-operands.register-or-class]</a></div>
<p><mark data-markjs="true">Input</mark> and output operands can be specified either as an explicit register or as a register class from which the register allocator can select a register.
Explicit registers are specified as string literals (e.g. <code class="hljs">"eax"</code>) while register classes are specified as identifiers (e.g. <code class="hljs">reg</code>).</p>
<div class="rule" id="asm.register-operands.equivalence-to-base-register"><a class="rule-link" href="#asm.register-operands.equivalence-to-base-register">[asm.register-operands.equivalence-to-base-register]</a></div>
<p>Note that explicit registers treat register aliases (e.g. <code class="hljs">r14</code> vs <code class="hljs">lr</code> on ARM) and smaller views of a register (e.g. <code class="hljs">eax</code> vs <code class="hljs">rax</code>) as equivalent to the base register.</p>
<div class="rule" id="asm.register-operands.error-two-operands"><a class="rule-link" href="#asm.register-operands.error-two-operands">[asm.register-operands.error-two-operands]</a></div>
<p>It is a compile-time error to use the same explicit register for two <mark data-markjs="true">input</mark> operands or two output operands.</p>
<div class="rule" id="asm.register-operands.error-overlapping"><a class="rule-link" href="#asm.register-operands.error-overlapping">[asm.register-operands.error-overlapping]</a></div>
<p>Additionally, it is also a compile-time error to use overlapping registers (e.g. ARM VFP) in <mark data-markjs="true">input</mark> operands or in output operands.</p>
<div class="rule" id="asm.register-operands.allowed-types"><a class="rule-link" href="#asm.register-operands.allowed-types">[asm.register-operands.allowed-types]</a></div>
<p>Only the following types are allowed as operands for inline assembly:</p>
<ul>
<li>Integers (signed and unsigned)</li>
<li>Floating-point numbers</li>
<li>Pointers (thin only)</li>
<li>Function pointers</li>
<li>SIMD vectors (structs defined with <code class="hljs">#[repr(simd)]</code> and which implement <code class="hljs">Copy</code>).
This includes architecture-specific vector types defined in <code class="hljs">std::arch</code> such as <code class="hljs">__m128</code> (x86) or <code class="hljs">int8x16_t</code> (ARM).</li>
</ul>
<div class="rule" id="asm.register-operands.supported-register-classes"><a class="rule-link" href="#asm.register-operands.supported-register-classes">[asm.register-operands.supported-register-classes]</a></div>
<p>Here is the list of currently supported register classes:</p>
<div class="table-wrapper"><table><thead><tr><th>Architecture</th><th>Register class</th><th>Registers</th><th>LLVM constraint code</th></tr></thead><tbody>
<tr><td>x86</td><td><code class="hljs">reg</code></td><td><code class="hljs">ax</code>, <code class="hljs">bx</code>, <code class="hljs">cx</code>, <code class="hljs">dx</code>, <code class="hljs">si</code>, <code class="hljs">di</code>, <code class="hljs">bp</code>, <code class="hljs">r[8-15]</code> (x86-64 only)</td><td><code class="hljs">r</code></td></tr>
<tr><td>x86</td><td><code class="hljs">reg_abcd</code></td><td><code class="hljs">ax</code>, <code class="hljs">bx</code>, <code class="hljs">cx</code>, <code class="hljs">dx</code></td><td><code class="hljs">Q</code></td></tr>
<tr><td>x86-32</td><td><code class="hljs">reg_byte</code></td><td><code class="hljs">al</code>, <code class="hljs">bl</code>, <code class="hljs">cl</code>, <code class="hljs">dl</code>, <code class="hljs">ah</code>, <code class="hljs">bh</code>, <code class="hljs">ch</code>, <code class="hljs">dh</code></td><td><code class="hljs">q</code></td></tr>
<tr><td>x86-64</td><td><code class="hljs">reg_byte</code>*</td><td><code class="hljs">al</code>, <code class="hljs">bl</code>, <code class="hljs">cl</code>, <code class="hljs">dl</code>, <code class="hljs">sil</code>, <code class="hljs">dil</code>, <code class="hljs">bpl</code>, <code class="hljs">r[8-15]b</code></td><td><code class="hljs">q</code></td></tr>
<tr><td>x86</td><td><code class="hljs">xmm_reg</code></td><td><code class="hljs">xmm[0-7]</code> (x86) <code class="hljs">xmm[0-15]</code> (x86-64)</td><td><code class="hljs">x</code></td></tr>
<tr><td>x86</td><td><code class="hljs">ymm_reg</code></td><td><code class="hljs">ymm[0-7]</code> (x86) <code class="hljs">ymm[0-15]</code> (x86-64)</td><td><code class="hljs">x</code></td></tr>
<tr><td>x86</td><td><code class="hljs">zmm_reg</code></td><td><code class="hljs">zmm[0-7]</code> (x86) <code class="hljs">zmm[0-31]</code> (x86-64)</td><td><code class="hljs">v</code></td></tr>
<tr><td>x86</td><td><code class="hljs">kreg</code></td><td><code class="hljs">k[1-7]</code></td><td><code class="hljs">Yk</code></td></tr>
<tr><td>x86</td><td><code class="hljs">kreg0</code></td><td><code class="hljs">k0</code></td><td>Only clobbers</td></tr>
<tr><td>x86</td><td><code class="hljs">x87_reg</code></td><td><code class="hljs">st([0-7])</code></td><td>Only clobbers</td></tr>
<tr><td>x86</td><td><code class="hljs">mmx_reg</code></td><td><code class="hljs">mm[0-7]</code></td><td>Only clobbers</td></tr>
<tr><td>x86-64</td><td><code class="hljs">tmm_reg</code></td><td><code class="hljs">tmm[0-7]</code></td><td>Only clobbers</td></tr>
<tr><td>AArch64</td><td><code class="hljs">reg</code></td><td><code class="hljs">x[0-30]</code></td><td><code class="hljs">r</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg</code></td><td><code class="hljs">v[0-31]</code></td><td><code class="hljs">w</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg_low16</code></td><td><code class="hljs">v[0-15]</code></td><td><code class="hljs">x</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">preg</code></td><td><code class="hljs">p[0-15]</code>, <code class="hljs">ffr</code></td><td>Only clobbers</td></tr>
<tr><td>ARM (ARM/Thumb2)</td><td><code class="hljs">reg</code></td><td><code class="hljs">r[0-12]</code>, <code class="hljs">r14</code></td><td><code class="hljs">r</code></td></tr>
<tr><td>ARM (Thumb1)</td><td><code class="hljs">reg</code></td><td><code class="hljs">r[0-7]</code></td><td><code class="hljs">r</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">sreg</code></td><td><code class="hljs">s[0-31]</code></td><td><code class="hljs">t</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">sreg_low16</code></td><td><code class="hljs">s[0-15]</code></td><td><code class="hljs">x</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">dreg</code></td><td><code class="hljs">d[0-31]</code></td><td><code class="hljs">w</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">dreg_low16</code></td><td><code class="hljs">d[0-15]</code></td><td><code class="hljs">t</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">dreg_low8</code></td><td><code class="hljs">d[0-8]</code></td><td><code class="hljs">x</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">qreg</code></td><td><code class="hljs">q[0-15]</code></td><td><code class="hljs">w</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">qreg_low8</code></td><td><code class="hljs">q[0-7]</code></td><td><code class="hljs">t</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">qreg_low4</code></td><td><code class="hljs">q[0-3]</code></td><td><code class="hljs">x</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">reg</code></td><td><code class="hljs">x1</code>, <code class="hljs">x[5-7]</code>, <code class="hljs">x[9-15]</code>, <code class="hljs">x[16-31]</code> (non-RV32E)</td><td><code class="hljs">r</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">freg</code></td><td><code class="hljs">f[0-31]</code></td><td><code class="hljs">f</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">vreg</code></td><td><code class="hljs">v[0-31]</code></td><td>Only clobbers</td></tr>
<tr><td>LoongArch</td><td><code class="hljs">reg</code></td><td><code class="hljs">$r1</code>, <code class="hljs">$r[4-20]</code>, <code class="hljs">$r[23,30]</code></td><td><code class="hljs">r</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">freg</code></td><td><code class="hljs">$f[0-31]</code></td><td><code class="hljs">f</code></td></tr>
</tbody></table>
</div>
<blockquote>
<p><strong>Notes</strong>:</p>
<ul>
<li>On x86 we treat <code class="hljs">reg_byte</code> differently from <code class="hljs">reg</code> because the compiler can allocate <code class="hljs">al</code> and <code class="hljs">ah</code> separately whereas <code class="hljs">reg</code> reserves the whole register.</li>
<li>On x86-64 the high byte registers (e.g. <code class="hljs">ah</code>) are not available in the <code class="hljs">reg_byte</code> register class.</li>
<li>Some register classes are marked as â€œOnly clobbersâ€ which means that registers in these classes cannot be used for <mark data-markjs="true">input</mark>s or outputs, only clobbers of the form <code class="hljs">out(&lt;explicit register&gt;) _</code> or <code class="hljs">lateout(&lt;explicit register&gt;) _</code>.</li>
</ul>
</blockquote>
<div class="rule" id="asm.register-operands.value-type-constraints"><a class="rule-link" href="#asm.register-operands.value-type-constraints">[asm.register-operands.value-type-constraints]</a></div>
<p>Each register class has constraints on which value types they can be used with.
This is necessary because the way a value is loaded into a register depends on its type.
For example, on big-endian systems, loading a <code class="hljs">i32x4</code> and a <code class="hljs">i8x16</code> into a SIMD register may result in different register contents even if the byte-wise memory representation of both values is identical.
The availability of supported types for a particular register class may depend on what target features are currently enabled.</p>
<div class="table-wrapper"><table><thead><tr><th>Architecture</th><th>Register class</th><th>Target feature</th><th>Allowed types</th></tr></thead><tbody>
<tr><td>x86-32</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">i16</code>, <code class="hljs">i32</code>, <code class="hljs">f32</code></td></tr>
<tr><td>x86-64</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">i16</code>, <code class="hljs">i32</code>, <code class="hljs">f32</code>, <code class="hljs">i64</code>, <code class="hljs">f64</code></td></tr>
<tr><td>x86</td><td><code class="hljs">reg_byte</code></td><td>None</td><td><code class="hljs">i8</code></td></tr>
<tr><td>x86</td><td><code class="hljs">xmm_reg</code></td><td><code class="hljs">sse</code></td><td><code class="hljs">i32</code>, <code class="hljs">f32</code>, <code class="hljs">i64</code>, <code class="hljs">f64</code>, <br> <code class="hljs">i8x16</code>, <code class="hljs">i16x8</code>, <code class="hljs">i32x4</code>, <code class="hljs">i64x2</code>, <code class="hljs">f32x4</code>, <code class="hljs">f64x2</code></td></tr>
<tr><td>x86</td><td><code class="hljs">ymm_reg</code></td><td><code class="hljs">avx</code></td><td><code class="hljs">i32</code>, <code class="hljs">f32</code>, <code class="hljs">i64</code>, <code class="hljs">f64</code>, <br> <code class="hljs">i8x16</code>, <code class="hljs">i16x8</code>, <code class="hljs">i32x4</code>, <code class="hljs">i64x2</code>, <code class="hljs">f32x4</code>, <code class="hljs">f64x2</code> <br> <code class="hljs">i8x32</code>, <code class="hljs">i16x16</code>, <code class="hljs">i32x8</code>, <code class="hljs">i64x4</code>, <code class="hljs">f32x8</code>, <code class="hljs">f64x4</code></td></tr>
<tr><td>x86</td><td><code class="hljs">zmm_reg</code></td><td><code class="hljs">avx512f</code></td><td><code class="hljs">i32</code>, <code class="hljs">f32</code>, <code class="hljs">i64</code>, <code class="hljs">f64</code>, <br> <code class="hljs">i8x16</code>, <code class="hljs">i16x8</code>, <code class="hljs">i32x4</code>, <code class="hljs">i64x2</code>, <code class="hljs">f32x4</code>, <code class="hljs">f64x2</code> <br> <code class="hljs">i8x32</code>, <code class="hljs">i16x16</code>, <code class="hljs">i32x8</code>, <code class="hljs">i64x4</code>, <code class="hljs">f32x8</code>, <code class="hljs">f64x4</code> <br> <code class="hljs">i8x64</code>, <code class="hljs">i16x32</code>, <code class="hljs">i32x16</code>, <code class="hljs">i64x8</code>, <code class="hljs">f32x16</code>, <code class="hljs">f64x8</code></td></tr>
<tr><td>x86</td><td><code class="hljs">kreg</code></td><td><code class="hljs">avx512f</code></td><td><code class="hljs">i8</code>, <code class="hljs">i16</code></td></tr>
<tr><td>x86</td><td><code class="hljs">kreg</code></td><td><code class="hljs">avx512bw</code></td><td><code class="hljs">i32</code>, <code class="hljs">i64</code></td></tr>
<tr><td>x86</td><td><code class="hljs">mmx_reg</code></td><td>N/A</td><td>Only clobbers</td></tr>
<tr><td>x86</td><td><code class="hljs">x87_reg</code></td><td>N/A</td><td>Only clobbers</td></tr>
<tr><td>x86</td><td><code class="hljs">tmm_reg</code></td><td>N/A</td><td>Only clobbers</td></tr>
<tr><td>AArch64</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">i8</code>, <code class="hljs">i16</code>, <code class="hljs">i32</code>, <code class="hljs">f32</code>, <code class="hljs">i64</code>, <code class="hljs">f64</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg</code></td><td><code class="hljs">neon</code></td><td><code class="hljs">i8</code>, <code class="hljs">i16</code>, <code class="hljs">i32</code>, <code class="hljs">f32</code>, <code class="hljs">i64</code>, <code class="hljs">f64</code>, <br> <code class="hljs">i8x8</code>, <code class="hljs">i16x4</code>, <code class="hljs">i32x2</code>, <code class="hljs">i64x1</code>, <code class="hljs">f32x2</code>, <code class="hljs">f64x1</code>, <br> <code class="hljs">i8x16</code>, <code class="hljs">i16x8</code>, <code class="hljs">i32x4</code>, <code class="hljs">i64x2</code>, <code class="hljs">f32x4</code>, <code class="hljs">f64x2</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">preg</code></td><td>N/A</td><td>Only clobbers</td></tr>
<tr><td>ARM</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">i8</code>, <code class="hljs">i16</code>, <code class="hljs">i32</code>, <code class="hljs">f32</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">sreg</code></td><td><code class="hljs">vfp2</code></td><td><code class="hljs">i32</code>, <code class="hljs">f32</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">dreg</code></td><td><code class="hljs">vfp2</code></td><td><code class="hljs">i64</code>, <code class="hljs">f64</code>, <code class="hljs">i8x8</code>, <code class="hljs">i16x4</code>, <code class="hljs">i32x2</code>, <code class="hljs">i64x1</code>, <code class="hljs">f32x2</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">qreg</code></td><td><code class="hljs">neon</code></td><td><code class="hljs">i8x16</code>, <code class="hljs">i16x8</code>, <code class="hljs">i32x4</code>, <code class="hljs">i64x2</code>, <code class="hljs">f32x4</code></td></tr>
<tr><td>RISC-V32</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">i8</code>, <code class="hljs">i16</code>, <code class="hljs">i32</code>, <code class="hljs">f32</code></td></tr>
<tr><td>RISC-V64</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">i8</code>, <code class="hljs">i16</code>, <code class="hljs">i32</code>, <code class="hljs">f32</code>, <code class="hljs">i64</code>, <code class="hljs">f64</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">freg</code></td><td><code class="hljs">f</code></td><td><code class="hljs">f32</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">freg</code></td><td><code class="hljs">d</code></td><td><code class="hljs">f64</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">vreg</code></td><td>N/A</td><td>Only clobbers</td></tr>
<tr><td>LoongArch64</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">i8</code>, <code class="hljs">i16</code>, <code class="hljs">i32</code>, <code class="hljs">i64</code>, <code class="hljs">f32</code>, <code class="hljs">f64</code></td></tr>
<tr><td>LoongArch64</td><td><code class="hljs">freg</code></td><td>None</td><td><code class="hljs">f32</code>, <code class="hljs">f64</code></td></tr>
</tbody></table>
</div>
<blockquote>
<p><strong>Note</strong>: For the purposes of the above table pointers, function pointers and <code class="hljs">isize</code>/<code class="hljs">usize</code> are treated as the equivalent integer type (<code class="hljs">i16</code>/<code class="hljs">i32</code>/<code class="hljs">i64</code> depending on the target).</p>
</blockquote>
<div class="rule" id="asm.register-operands.smaller-value"><a class="rule-link" href="#asm.register-operands.smaller-value">[asm.register-operands.smaller-value]</a></div>
<p>If a value is of a smaller size than the register it is allocated in then the upper bits of that register will have an undefined value for <mark data-markjs="true">input</mark>s and will be ignored for outputs.
The only exception is the <code class="hljs">freg</code> register class on RISC-V where <code class="hljs">f32</code> values are NaN-boxed in a <code class="hljs">f64</code> as required by the RISC-V architecture.</p>
<div class="rule" id="asm.register-operands.separate-input-output"><a class="rule-link" href="#asm.register-operands.separate-input-output">[asm.register-operands.separate-<mark data-markjs="true">input</mark>-output]</a></div>
<p>When separate <mark data-markjs="true">input</mark> and output expressions are specified for an <code class="hljs">inout</code> operand, both expressions must have the same type.
The only exception is if both operands are pointers or integers, in which case they are only required to have the same size.
This restriction exists because the register allocators in LLVM and GCC sometimes cannot handle tied operands with different types.</p>
<h2 id="register-names"><a class="header" href="#register-names">Register names</a></h2>
<div class="rule" id="asm.register-names"><a class="rule-link" href="#asm.register-names">[asm.register-names]</a></div>
<div class="rule" id="asm.register-names.supported-register-aliases"><a class="rule-link" href="#asm.register-names.supported-register-aliases">[asm.register-names.supported-register-aliases]</a></div>
<p>Some registers have multiple names.
These are all treated by the compiler as identical to the base register name.
Here is the list of all supported register aliases:</p>
<div class="table-wrapper"><table><thead><tr><th>Architecture</th><th>Base register</th><th>Aliases</th></tr></thead><tbody>
<tr><td>x86</td><td><code class="hljs">ax</code></td><td><code class="hljs">eax</code>, <code class="hljs">rax</code></td></tr>
<tr><td>x86</td><td><code class="hljs">bx</code></td><td><code class="hljs">ebx</code>, <code class="hljs">rbx</code></td></tr>
<tr><td>x86</td><td><code class="hljs">cx</code></td><td><code class="hljs">ecx</code>, <code class="hljs">rcx</code></td></tr>
<tr><td>x86</td><td><code class="hljs">dx</code></td><td><code class="hljs">edx</code>, <code class="hljs">rdx</code></td></tr>
<tr><td>x86</td><td><code class="hljs">si</code></td><td><code class="hljs">esi</code>, <code class="hljs">rsi</code></td></tr>
<tr><td>x86</td><td><code class="hljs">di</code></td><td><code class="hljs">edi</code>, <code class="hljs">rdi</code></td></tr>
<tr><td>x86</td><td><code class="hljs">bp</code></td><td><code class="hljs">bpl</code>, <code class="hljs">ebp</code>, <code class="hljs">rbp</code></td></tr>
<tr><td>x86</td><td><code class="hljs">sp</code></td><td><code class="hljs">spl</code>, <code class="hljs">esp</code>, <code class="hljs">rsp</code></td></tr>
<tr><td>x86</td><td><code class="hljs">ip</code></td><td><code class="hljs">eip</code>, <code class="hljs">rip</code></td></tr>
<tr><td>x86</td><td><code class="hljs">st(0)</code></td><td><code class="hljs">st</code></td></tr>
<tr><td>x86</td><td><code class="hljs">r[8-15]</code></td><td><code class="hljs">r[8-15]b</code>, <code class="hljs">r[8-15]w</code>, <code class="hljs">r[8-15]d</code></td></tr>
<tr><td>x86</td><td><code class="hljs">xmm[0-31]</code></td><td><code class="hljs">ymm[0-31]</code>, <code class="hljs">zmm[0-31]</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">x[0-30]</code></td><td><code class="hljs">w[0-30]</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">x29</code></td><td><code class="hljs">fp</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">x30</code></td><td><code class="hljs">lr</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">sp</code></td><td><code class="hljs">wsp</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">xzr</code></td><td><code class="hljs">wzr</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">v[0-31]</code></td><td><code class="hljs">b[0-31]</code>, <code class="hljs">h[0-31]</code>, <code class="hljs">s[0-31]</code>, <code class="hljs">d[0-31]</code>, <code class="hljs">q[0-31]</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">r[0-3]</code></td><td><code class="hljs">a[1-4]</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">r[4-9]</code></td><td><code class="hljs">v[1-6]</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">r9</code></td><td><code class="hljs">rfp</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">r10</code></td><td><code class="hljs">sl</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">r11</code></td><td><code class="hljs">fp</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">r12</code></td><td><code class="hljs">ip</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">r13</code></td><td><code class="hljs">sp</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">r14</code></td><td><code class="hljs">lr</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">r15</code></td><td><code class="hljs">pc</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x0</code></td><td><code class="hljs">zero</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x1</code></td><td><code class="hljs">ra</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x2</code></td><td><code class="hljs">sp</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x3</code></td><td><code class="hljs">gp</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x4</code></td><td><code class="hljs">tp</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x[5-7]</code></td><td><code class="hljs">t[0-2]</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x8</code></td><td><code class="hljs">fp</code>, <code class="hljs">s0</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x9</code></td><td><code class="hljs">s1</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x[10-17]</code></td><td><code class="hljs">a[0-7]</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x[18-27]</code></td><td><code class="hljs">s[2-11]</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x[28-31]</code></td><td><code class="hljs">t[3-6]</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">f[0-7]</code></td><td><code class="hljs">ft[0-7]</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">f[8-9]</code></td><td><code class="hljs">fs[0-1]</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">f[10-17]</code></td><td><code class="hljs">fa[0-7]</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">f[18-27]</code></td><td><code class="hljs">fs[2-11]</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">f[28-31]</code></td><td><code class="hljs">ft[8-11]</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r0</code></td><td><code class="hljs">$zero</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r1</code></td><td><code class="hljs">$ra</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r2</code></td><td><code class="hljs">$tp</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r3</code></td><td><code class="hljs">$sp</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r[4-11]</code></td><td><code class="hljs">$a[0-7]</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r[12-20]</code></td><td><code class="hljs">$t[0-8]</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r21</code></td><td></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r22</code></td><td><code class="hljs">$fp</code>, <code class="hljs">$s9</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r[23-31]</code></td><td><code class="hljs">$s[0-8]</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$f[0-7]</code></td><td><code class="hljs">$fa[0-7]</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$f[8-23]</code></td><td><code class="hljs">$ft[0-15]</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$f[24-31]</code></td><td><code class="hljs">$fs[0-7]</code></td></tr>
</tbody></table>
</div><div class="rule" id="asm.register-names.not-for-io"><a class="rule-link" href="#asm.register-names.not-for-io">[asm.register-names.not-for-io]</a></div>
<p>Some registers cannot be used for <mark data-markjs="true">input</mark> or output operands:</p>
<div class="table-wrapper"><table><thead><tr><th>Architecture</th><th>Unsupported register</th><th>Reason</th></tr></thead><tbody>
<tr><td>All</td><td><code class="hljs">sp</code></td><td>The stack pointer must be restored to its original value at the end of an asm code block.</td></tr>
<tr><td>All</td><td><code class="hljs">bp</code> (x86), <code class="hljs">x29</code> (AArch64), <code class="hljs">x8</code> (RISC-V), <code class="hljs">$fp</code> (LoongArch)</td><td>The frame pointer cannot be used as an <mark data-markjs="true">input</mark> or output.</td></tr>
<tr><td>ARM</td><td><code class="hljs">r7</code> or <code class="hljs">r11</code></td><td>On ARM the frame pointer can be either <code class="hljs">r7</code> or <code class="hljs">r11</code> depending on the target. The frame pointer cannot be used as an <mark data-markjs="true">input</mark> or output.</td></tr>
<tr><td>All</td><td><code class="hljs">si</code> (x86-32), <code class="hljs">bx</code> (x86-64), <code class="hljs">r6</code> (ARM), <code class="hljs">x19</code> (AArch64), <code class="hljs">x9</code> (RISC-V), <code class="hljs">$s8</code> (LoongArch)</td><td>This is used internally by LLVM as a â€œbase pointerâ€ for functions with complex stack frames.</td></tr>
<tr><td>x86</td><td><code class="hljs">ip</code></td><td>This is the program counter, not a real register.</td></tr>
<tr><td>AArch64</td><td><code class="hljs">xzr</code></td><td>This is a constant zero register which canâ€™t be modified.</td></tr>
<tr><td>AArch64</td><td><code class="hljs">x18</code></td><td>This is an OS-reserved register on some AArch64 targets.</td></tr>
<tr><td>ARM</td><td><code class="hljs">pc</code></td><td>This is the program counter, not a real register.</td></tr>
<tr><td>ARM</td><td><code class="hljs">r9</code></td><td>This is an OS-reserved register on some ARM targets.</td></tr>
<tr><td>RISC-V</td><td><code class="hljs">x0</code></td><td>This is a constant zero register which canâ€™t be modified.</td></tr>
<tr><td>RISC-V</td><td><code class="hljs">gp</code>, <code class="hljs">tp</code></td><td>These registers are reserved and cannot be used as <mark data-markjs="true">input</mark>s or outputs.</td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r0</code> or <code class="hljs">$zero</code></td><td>This is a constant zero register which canâ€™t be modified.</td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r2</code> or <code class="hljs">$tp</code></td><td>This is reserved for TLS.</td></tr>
<tr><td>LoongArch</td><td><code class="hljs">$r21</code></td><td>This is reserved by the ABI.</td></tr>
</tbody></table>
</div><div class="rule" id="asm.register-names.fp-bp-reserved"><a class="rule-link" href="#asm.register-names.fp-bp-reserved">[asm.register-names.fp-bp-reserved]</a></div>
<p>The frame pointer and base pointer registers are reserved for internal use by LLVM. While <code class="hljs">asm!</code> statements cannot explicitly specify the use of reserved registers, in some cases LLVM will allocate one of these reserved registers for <code class="hljs">reg</code> operands. Assembly code making use of reserved registers should be careful since <code class="hljs">reg</code> operands may use the same registers.</p>
<h2 id="template-modifiers"><a class="header" href="#template-modifiers">Template modifiers</a></h2>
<div class="rule" id="asm.template-modifiers"><a class="rule-link" href="#asm.template-modifiers">[asm.template-modifiers]</a></div>
<div class="rule" id="asm.template-modifiers.intro"><a class="rule-link" href="#asm.template-modifiers.intro">[asm.template-modifiers.intro]</a></div>
<p>The placeholders can be augmented by modifiers which are specified after the <code class="hljs">:</code> in the curly braces.
These modifiers do not affect register allocation, but change the way operands are formatted when inserted into the template string.</p>
<div class="rule" id="asm.template-modifiers.only-one"><a class="rule-link" href="#asm.template-modifiers.only-one">[asm.template-modifiers.only-one]</a></div>
<p>Only one modifier is allowed per template placeholder.</p>
<div class="rule" id="asm.template-modifiers.supported-modifiers"><a class="rule-link" href="#asm.template-modifiers.supported-modifiers">[asm.template-modifiers.supported-modifiers]</a></div>
<p>The supported modifiers are a subset of LLVMâ€™s (and GCCâ€™s) <a href="http://llvm.org/docs/LangRef.html#asm-template-argument-modifiers">asm template argument modifiers</a>, but do not use the same letter codes.</p>
<div class="table-wrapper"><table><thead><tr><th>Architecture</th><th>Register class</th><th>Modifier</th><th>Example output</th><th>LLVM modifier</th></tr></thead><tbody>
<tr><td>x86-32</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">eax</code></td><td><code class="hljs">k</code></td></tr>
<tr><td>x86-64</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">rax</code></td><td><code class="hljs">q</code></td></tr>
<tr><td>x86-32</td><td><code class="hljs">reg_abcd</code></td><td><code class="hljs">l</code></td><td><code class="hljs">al</code></td><td><code class="hljs">b</code></td></tr>
<tr><td>x86-64</td><td><code class="hljs">reg</code></td><td><code class="hljs">l</code></td><td><code class="hljs">al</code></td><td><code class="hljs">b</code></td></tr>
<tr><td>x86</td><td><code class="hljs">reg_abcd</code></td><td><code class="hljs">h</code></td><td><code class="hljs">ah</code></td><td><code class="hljs">h</code></td></tr>
<tr><td>x86</td><td><code class="hljs">reg</code></td><td><code class="hljs">x</code></td><td><code class="hljs">ax</code></td><td><code class="hljs">w</code></td></tr>
<tr><td>x86</td><td><code class="hljs">reg</code></td><td><code class="hljs">e</code></td><td><code class="hljs">eax</code></td><td><code class="hljs">k</code></td></tr>
<tr><td>x86-64</td><td><code class="hljs">reg</code></td><td><code class="hljs">r</code></td><td><code class="hljs">rax</code></td><td><code class="hljs">q</code></td></tr>
<tr><td>x86</td><td><code class="hljs">reg_byte</code></td><td>None</td><td><code class="hljs">al</code> / <code class="hljs">ah</code></td><td>None</td></tr>
<tr><td>x86</td><td><code class="hljs">xmm_reg</code></td><td>None</td><td><code class="hljs">xmm0</code></td><td><code class="hljs">x</code></td></tr>
<tr><td>x86</td><td><code class="hljs">ymm_reg</code></td><td>None</td><td><code class="hljs">ymm0</code></td><td><code class="hljs">t</code></td></tr>
<tr><td>x86</td><td><code class="hljs">zmm_reg</code></td><td>None</td><td><code class="hljs">zmm0</code></td><td><code class="hljs">g</code></td></tr>
<tr><td>x86</td><td><code class="hljs">*mm_reg</code></td><td><code class="hljs">x</code></td><td><code class="hljs">xmm0</code></td><td><code class="hljs">x</code></td></tr>
<tr><td>x86</td><td><code class="hljs">*mm_reg</code></td><td><code class="hljs">y</code></td><td><code class="hljs">ymm0</code></td><td><code class="hljs">t</code></td></tr>
<tr><td>x86</td><td><code class="hljs">*mm_reg</code></td><td><code class="hljs">z</code></td><td><code class="hljs">zmm0</code></td><td><code class="hljs">g</code></td></tr>
<tr><td>x86</td><td><code class="hljs">kreg</code></td><td>None</td><td><code class="hljs">k1</code></td><td>None</td></tr>
<tr><td>AArch64</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">x0</code></td><td><code class="hljs">x</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">reg</code></td><td><code class="hljs">w</code></td><td><code class="hljs">w0</code></td><td><code class="hljs">w</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">reg</code></td><td><code class="hljs">x</code></td><td><code class="hljs">x0</code></td><td><code class="hljs">x</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg</code></td><td>None</td><td><code class="hljs">v0</code></td><td>None</td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg</code></td><td><code class="hljs">v</code></td><td><code class="hljs">v0</code></td><td>None</td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg</code></td><td><code class="hljs">b</code></td><td><code class="hljs">b0</code></td><td><code class="hljs">b</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg</code></td><td><code class="hljs">h</code></td><td><code class="hljs">h0</code></td><td><code class="hljs">h</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg</code></td><td><code class="hljs">s</code></td><td><code class="hljs">s0</code></td><td><code class="hljs">s</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg</code></td><td><code class="hljs">d</code></td><td><code class="hljs">d0</code></td><td><code class="hljs">d</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">vreg</code></td><td><code class="hljs">q</code></td><td><code class="hljs">q0</code></td><td><code class="hljs">q</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">r0</code></td><td>None</td></tr>
<tr><td>ARM</td><td><code class="hljs">sreg</code></td><td>None</td><td><code class="hljs">s0</code></td><td>None</td></tr>
<tr><td>ARM</td><td><code class="hljs">dreg</code></td><td>None</td><td><code class="hljs">d0</code></td><td><code class="hljs">P</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">qreg</code></td><td>None</td><td><code class="hljs">q0</code></td><td><code class="hljs">q</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">qreg</code></td><td><code class="hljs">e</code> / <code class="hljs">f</code></td><td><code class="hljs">d0</code> / <code class="hljs">d1</code></td><td><code class="hljs">e</code> / <code class="hljs">f</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">x1</code></td><td>None</td></tr>
<tr><td>RISC-V</td><td><code class="hljs">freg</code></td><td>None</td><td><code class="hljs">f0</code></td><td>None</td></tr>
<tr><td>LoongArch</td><td><code class="hljs">reg</code></td><td>None</td><td><code class="hljs">$r1</code></td><td>None</td></tr>
<tr><td>LoongArch</td><td><code class="hljs">freg</code></td><td>None</td><td><code class="hljs">$f0</code></td><td>None</td></tr>
</tbody></table>
</div>
<blockquote>
<p><strong>Notes</strong>:</p>
<ul>
<li>on ARM <code class="hljs">e</code> / <code class="hljs">f</code>: this prints the low or high doubleword register name of a NEON quad (128-bit) register.</li>
<li>on x86: our behavior for <code class="hljs">reg</code> with no modifiers differs from what GCC does.
GCC will infer the modifier based on the operand value type, while we default to the full register size.</li>
<li>on x86 <code class="hljs">xmm_reg</code>: the <code class="hljs">x</code>, <code class="hljs">t</code> and <code class="hljs">g</code> LLVM modifiers are not yet implemented in LLVM (they are supported by GCC only), but this should be a simple change.</li>
</ul>
</blockquote>
<div class="rule" id="asm.template-modifiers.smaller-value"><a class="rule-link" href="#asm.template-modifiers.smaller-value">[asm.template-modifiers.smaller-value]</a></div>
<p>As stated in the previous section, passing an <mark data-markjs="true">input</mark> value smaller than the register width will result in the upper bits of the register containing undefined values.
This is not a problem if the inline asm only accesses the lower bits of the register, which can be done by using a template modifier to use a subregister name in the asm code (e.g. <code class="hljs">ax</code> instead of <code class="hljs">rax</code>).
Since this an easy pitfall, the compiler will suggest a template modifier to use where appropriate given the <mark data-markjs="true">input</mark> type.
If all references to an operand already have modifiers then the warning is suppressed for that operand.</p>
<h2 id="abi-clobbers"><a class="header" href="#abi-clobbers">ABI clobbers</a></h2>
<div class="rule" id="asm.abi-clobbers"><a class="rule-link" href="#asm.abi-clobbers">[asm.abi-clobbers]</a></div>
<div class="rule" id="asm.abi-clobbers.intro"><a class="rule-link" href="#asm.abi-clobbers.intro">[asm.abi-clobbers.intro]</a></div>
<p>The <code class="hljs">clobber_abi</code> keyword can be used to apply a default set of clobbers to an <code class="hljs">asm!</code> block.
This will automatically insert the necessary clobber constraints as needed for calling a function with a particular calling convention: if the calling convention does not fully preserve the value of a register across a call then <code class="hljs">lateout("...") _</code> is implicitly added to the operands list (where the <code class="hljs">...</code> is replaced by the registerâ€™s name).</p>
<div class="rule" id="asm.abi-clobbers.many"><a class="rule-link" href="#asm.abi-clobbers.many">[asm.abi-clobbers.many]</a></div>
<p><code class="hljs">clobber_abi</code> may be specified any number of times. It will insert a clobber for all unique registers in the union of all specified calling conventions.</p>
<div class="rule" id="asm.abi-clobbers.must-specify"><a class="rule-link" href="#asm.abi-clobbers.must-specify">[asm.abi-clobbers.must-specify]</a></div>
<p>Generic register class outputs are disallowed by the compiler when <code class="hljs">clobber_abi</code> is used: all outputs must specify an explicit register.</p>
<div class="rule" id="asm.abi-clobbers.explicit-have-precedence"><a class="rule-link" href="#asm.abi-clobbers.explicit-have-precedence">[asm.abi-clobbers.explicit-have-precedence]</a></div>
<p>Explicit register outputs have precedence over the implicit clobbers inserted by <code class="hljs">clobber_abi</code>: a clobber will only be inserted for a register if that register is not used as an output.</p>
<div class="rule" id="asm.abi-clobbers.supported-abis"><a class="rule-link" href="#asm.abi-clobbers.supported-abis">[asm.abi-clobbers.supported-abis]</a></div>
<p>The following ABIs can be used with <code class="hljs">clobber_abi</code>:</p>
<div class="table-wrapper"><table><thead><tr><th>Architecture</th><th>ABI name</th><th>Clobbered registers</th></tr></thead><tbody>
<tr><td>x86-32</td><td><code class="hljs">"C"</code>, <code class="hljs">"system"</code>, <code class="hljs">"efiapi"</code>, <code class="hljs">"cdecl"</code>, <code class="hljs">"stdcall"</code>, <code class="hljs">"fastcall"</code></td><td><code class="hljs">ax</code>, <code class="hljs">cx</code>, <code class="hljs">dx</code>, <code class="hljs">xmm[0-7]</code>, <code class="hljs">mm[0-7]</code>, <code class="hljs">k[0-7]</code>, <code class="hljs">st([0-7])</code></td></tr>
<tr><td>x86-64</td><td><code class="hljs">"C"</code>, <code class="hljs">"system"</code> (on Windows), <code class="hljs">"efiapi"</code>, <code class="hljs">"win64"</code></td><td><code class="hljs">ax</code>, <code class="hljs">cx</code>, <code class="hljs">dx</code>, <code class="hljs">r[8-11]</code>, <code class="hljs">xmm[0-31]</code>, <code class="hljs">mm[0-7]</code>, <code class="hljs">k[0-7]</code>, <code class="hljs">st([0-7])</code>, <code class="hljs">tmm[0-7]</code></td></tr>
<tr><td>x86-64</td><td><code class="hljs">"C"</code>, <code class="hljs">"system"</code> (on non-Windows), <code class="hljs">"sysv64"</code></td><td><code class="hljs">ax</code>, <code class="hljs">cx</code>, <code class="hljs">dx</code>, <code class="hljs">si</code>, <code class="hljs">di</code>, <code class="hljs">r[8-11]</code>, <code class="hljs">xmm[0-31]</code>, <code class="hljs">mm[0-7]</code>, <code class="hljs">k[0-7]</code>, <code class="hljs">st([0-7])</code>, <code class="hljs">tmm[0-7]</code></td></tr>
<tr><td>AArch64</td><td><code class="hljs">"C"</code>, <code class="hljs">"system"</code>, <code class="hljs">"efiapi"</code></td><td><code class="hljs">x[0-17]</code>, <code class="hljs">x18</code>*, <code class="hljs">x30</code>, <code class="hljs">v[0-31]</code>, <code class="hljs">p[0-15]</code>, <code class="hljs">ffr</code></td></tr>
<tr><td>ARM</td><td><code class="hljs">"C"</code>, <code class="hljs">"system"</code>, <code class="hljs">"efiapi"</code>, <code class="hljs">"aapcs"</code></td><td><code class="hljs">r[0-3]</code>, <code class="hljs">r12</code>, <code class="hljs">r14</code>, <code class="hljs">s[0-15]</code>, <code class="hljs">d[0-7]</code>, <code class="hljs">d[16-31]</code></td></tr>
<tr><td>RISC-V</td><td><code class="hljs">"C"</code>, <code class="hljs">"system"</code>, <code class="hljs">"efiapi"</code></td><td><code class="hljs">x1</code>, <code class="hljs">x[5-7]</code>, <code class="hljs">x[10-17]</code>, <code class="hljs">x[28-31]</code>, <code class="hljs">f[0-7]</code>, <code class="hljs">f[10-17]</code>, <code class="hljs">f[28-31]</code>, <code class="hljs">v[0-31]</code></td></tr>
<tr><td>LoongArch</td><td><code class="hljs">"C"</code>, <code class="hljs">"system"</code>, <code class="hljs">"efiapi"</code></td><td><code class="hljs">$r1</code>, <code class="hljs">$r[4-20]</code>, <code class="hljs">$f[0-23]</code></td></tr>
</tbody></table>
</div>
<blockquote>
<p>Notes:</p>
<ul>
<li>On AArch64 <code class="hljs">x18</code> only included in the clobber list if it is not considered as a reserved register on the target.</li>
</ul>
</blockquote>
<p>The list of clobbered registers for each ABI is updated in rustc as architectures gain new registers: this ensures that <code class="hljs">asm!</code> clobbers will continue to be correct when LLVM starts using these new registers in its generated code.</p>
<h2 id="options"><a class="header" href="#options">Options</a></h2>
<div class="rule" id="asm.options"><a class="rule-link" href="#asm.options">[asm.options]</a></div>
<div class="rule" id="asm.options.supported-options"><a class="rule-link" href="#asm.options.supported-options">[asm.options.supported-options]</a></div>
<p>Flags are used to further influence the behavior of the inline assembly block.
Currently the following options are defined:</p>
<div class="rule" id="asm.options.supported-options.pure"><a class="rule-link" href="#asm.options.supported-options.pure">[asm.options.supported-options.pure]</a></div>
<ul>
<li><code class="hljs">pure</code>: The <code class="hljs">asm!</code> block has no side effects, must eventually return, and its outputs depend only on its direct <mark data-markjs="true">input</mark>s (i.e. the values themselves, not what they point to) or values read from memory (unless the <code class="hljs">nomem</code> options is also set).
This allows the compiler to execute the <code class="hljs">asm!</code> block fewer times than specified in the program (e.g. by hoisting it out of a loop) or even eliminate it entirely if the outputs are not used.
The <code class="hljs">pure</code> option must be combined with either the <code class="hljs">nomem</code> or <code class="hljs">readonly</code> options, otherwise a compile-time error is emitted.</li>
</ul>
<div class="rule" id="asm.options.supported-options.nomem"><a class="rule-link" href="#asm.options.supported-options.nomem">[asm.options.supported-options.nomem]</a></div>
<ul>
<li><code class="hljs">nomem</code>: The <code class="hljs">asm!</code> blocks does not read or write to any memory.
This allows the compiler to cache the values of modified global variables in registers across the <code class="hljs">asm!</code> block since it knows that they are not read or written to by the <code class="hljs">asm!</code>.
The compiler also assumes that this <code class="hljs">asm!</code> block does not perform any kind of synchronization with other threads, e.g. via fences.</li>
</ul>
<div class="rule" id="asm.options.supported-options.readonly"><a class="rule-link" href="#asm.options.supported-options.readonly">[asm.options.supported-options.readonly]</a></div>
<ul>
<li><code class="hljs">readonly</code>: The <code class="hljs">asm!</code> block does not write to any memory.
This allows the compiler to cache the values of unmodified global variables in registers across the <code class="hljs">asm!</code> block since it knows that they are not written to by the <code class="hljs">asm!</code>.
The compiler also assumes that this <code class="hljs">asm!</code> block does not perform any kind of synchronization with other threads, e.g. via fences.</li>
</ul>
<div class="rule" id="asm.options.supported-options.preserves_flags"><a class="rule-link" href="#asm.options.supported-options.preserves_flags">[asm.options.supported-options.preserves_flags]</a></div>
<ul>
<li><code class="hljs">preserves_flags</code>: The <code class="hljs">asm!</code> block does not modify the flags register (defined in the rules below).
This allows the compiler to avoid recomputing the condition flags after the <code class="hljs">asm!</code> block.</li>
</ul>
<div class="rule" id="asm.options.supported-options.noreturn"><a class="rule-link" href="#asm.options.supported-options.noreturn">[asm.options.supported-options.noreturn]</a></div>
<ul>
<li><code class="hljs">noreturn</code>: The <code class="hljs">asm!</code> block never returns, and its return type is defined as <code class="hljs">!</code> (never).
Behavior is undefined if execution falls through past the end of the asm code.
A <code class="hljs">noreturn</code> asm block behaves just like a function which doesnâ€™t return; notably, local variables in scope are not dropped before it is invoked.</li>
</ul>
<div class="rule" id="asm.options.supported-options.nostack"><a class="rule-link" href="#asm.options.supported-options.nostack">[asm.options.supported-options.nostack]</a></div>
<ul>
<li><code class="hljs">nostack</code>: The <code class="hljs">asm!</code> block does not push data to the stack, or write to the stack red-zone (if supported by the target).
If this option is <em>not</em> used then the stack pointer is guaranteed to be suitably aligned (according to the target ABI) for a function call.</li>
</ul>
<div class="rule" id="asm.options.supported-options.att_syntax"><a class="rule-link" href="#asm.options.supported-options.att_syntax">[asm.options.supported-options.att_syntax]</a></div>
<ul>
<li><code class="hljs">att_syntax</code>: This option is only valid on x86, and causes the assembler to use the <code class="hljs">.att_syntax prefix</code> mode of the GNU assembler.
Register operands are substituted in with a leading <code class="hljs">%</code>.</li>
</ul>
<div class="rule" id="asm.options.supported-options.raw"><a class="rule-link" href="#asm.options.supported-options.raw">[asm.options.supported-options.raw]</a></div>
<ul>
<li><code class="hljs">raw</code>: This causes the template string to be parsed as a raw assembly string, with no special handling for <code class="hljs">{</code> and <code class="hljs">}</code>.
This is primarily useful when including raw assembly code from an external file using <code class="hljs">include_str!</code>.</li>
</ul>
<div class="rule" id="asm.options.checks"><a class="rule-link" href="#asm.options.checks">[asm.options.checks]</a></div>
<p>The compiler performs some additional checks on options:</p>
<div class="rule" id="asm.options.checks.mutually-exclusive"><a class="rule-link" href="#asm.options.checks.mutually-exclusive">[asm.options.checks.mutually-exclusive]</a></div>
<ul>
<li>The <code class="hljs">nomem</code> and <code class="hljs">readonly</code> options are mutually exclusive: it is a compile-time error to specify both.</li>
</ul>
<div class="rule" id="asm.options.checks.pure"><a class="rule-link" href="#asm.options.checks.pure">[asm.options.checks.pure]</a></div>
<ul>
<li>It is a compile-time error to specify <code class="hljs">pure</code> on an asm block with no outputs or only discarded outputs (<code class="hljs">_</code>).</li>
</ul>
<div class="rule" id="asm.options.checks.noreturn"><a class="rule-link" href="#asm.options.checks.noreturn">[asm.options.checks.noreturn]</a></div>
<ul>
<li>It is a compile-time error to specify <code class="hljs">noreturn</code> on an asm block with outputs.</li>
</ul>
<div class="rule" id="asm.options.global_asm-restriction"><a class="rule-link" href="#asm.options.global_asm-restriction">[asm.options.global_asm-restriction]</a></div>
<p><code class="hljs">global_asm!</code> only supports the <code class="hljs">att_syntax</code> and <code class="hljs">raw</code> options.
The remaining options are not meaningful for global-scope inline assembly</p>
<h2 id="rules-for-inline-assembly"><a class="header" href="#rules-for-inline-assembly">Rules for inline assembly</a></h2>
<div class="rule" id="asm.rules"><a class="rule-link" href="#asm.rules">[asm.rules]</a></div>
<div class="rule" id="asm.rules.intro"><a class="rule-link" href="#asm.rules.intro">[asm.rules.intro]</a></div>
<p>To avoid undefined behavior, these rules must be followed when using function-scope inline assembly (<code class="hljs">asm!</code>):</p>
<div class="rule" id="asm.rules.reg-not-input"><a class="rule-link" href="#asm.rules.reg-not-input">[asm.rules.reg-not-<mark data-markjs="true">input</mark>]</a></div>
<ul>
<li>Any registers not specified as <mark data-markjs="true">input</mark>s will contain an undefined value on entry to the asm block.
<ul>
<li>An â€œundefined valueâ€ in the context of inline assembly means that the register can (non-deterministically) have any one of the possible values allowed by the architecture.
Notably it is not the same as an LLVM <code class="hljs">undef</code> which can have a different value every time you read it (since such a concept does not exist in assembly code).</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.reg-not-output"><a class="rule-link" href="#asm.rules.reg-not-output">[asm.rules.reg-not-output]</a></div>
<ul>
<li>Any registers not specified as outputs must have the same value upon exiting the asm block as they had on entry, otherwise behavior is undefined.
<ul>
<li>This only applies to registers which can be specified as an <mark data-markjs="true">input</mark> or output.
Other registers follow target-specific rules.</li>
<li>Note that a <code class="hljs">lateout</code> may be allocated to the same register as an <code class="hljs">in</code>, in which case this rule does not apply.
Code should not rely on this however since it depends on the results of register allocation.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.unwind"><a class="rule-link" href="#asm.rules.unwind">[asm.rules.unwind]</a></div>
<ul>
<li>Behavior is undefined if execution unwinds out of an asm block.
<ul>
<li>This also applies if the assembly code calls a function which then unwinds.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.mem-same-as-ffi"><a class="rule-link" href="#asm.rules.mem-same-as-ffi">[asm.rules.mem-same-as-ffi]</a></div>
<ul>
<li>The set of memory locations that assembly code is allowed to read and write are the same as those allowed for an FFI function.
<ul>
<li>Refer to the unsafe code guidelines for the exact rules.</li>
<li>If the <code class="hljs">readonly</code> option is set, then only memory reads are allowed.</li>
<li>If the <code class="hljs">nomem</code> option is set then no reads or writes to memory are allowed.</li>
<li>These rules do not apply to memory which is private to the asm code, such as stack space allocated within the asm block.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.black-box"><a class="rule-link" href="#asm.rules.black-box">[asm.rules.black-box]</a></div>
<ul>
<li>The compiler cannot assume that the instructions in the asm are the ones that will actually end up executed.
<ul>
<li>This effectively means that the compiler must treat the <code class="hljs">asm!</code> as a black box and only take the interface specification into account, not the instructions themselves.</li>
<li>Runtime code patching is allowed, via target-specific mechanisms.</li>
<li>However there is no guarantee that each <code class="hljs">asm!</code> directly corresponds to a single instance of instructions in the object file: the compiler is free to duplicate or deduplicate <code class="hljs">asm!</code> blocks.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.stack-below-sp"><a class="rule-link" href="#asm.rules.stack-below-sp">[asm.rules.stack-below-sp]</a></div>
<ul>
<li>Unless the <code class="hljs">nostack</code> option is set, asm code is allowed to use stack space below the stack pointer.
<ul>
<li>On entry to the asm block the stack pointer is guaranteed to be suitably aligned (according to the target ABI) for a function call.</li>
<li>You are responsible for making sure you donâ€™t overflow the stack (e.g. use stack probing to ensure you hit a guard page).</li>
<li>You should adjust the stack pointer when allocating stack memory as required by the target ABI.</li>
<li>The stack pointer must be restored to its original value before leaving the asm block.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.noreturn"><a class="rule-link" href="#asm.rules.noreturn">[asm.rules.noreturn]</a></div>
<ul>
<li>If the <code class="hljs">noreturn</code> option is set then behavior is undefined if execution falls through to the end of the asm block.</li>
</ul>
<div class="rule" id="asm.rules.pure"><a class="rule-link" href="#asm.rules.pure">[asm.rules.pure]</a></div>
<ul>
<li>If the <code class="hljs">pure</code> option is set then behavior is undefined if the <code class="hljs">asm!</code> has side-effects other than its direct outputs.
Behavior is also undefined if two executions of the <code class="hljs">asm!</code> code with the same <mark data-markjs="true">input</mark>s result in different outputs.
<ul>
<li>When used with the <code class="hljs">nomem</code> option, â€œ<mark data-markjs="true">input</mark>sâ€ are just the direct <mark data-markjs="true">input</mark>s of the <code class="hljs">asm!</code>.</li>
<li>When used with the <code class="hljs">readonly</code> option, â€œ<mark data-markjs="true">input</mark>sâ€ comprise the direct <mark data-markjs="true">input</mark>s of the <code class="hljs">asm!</code> and any memory that the <code class="hljs">asm!</code> block is allowed to read.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.preserved-registers"><a class="rule-link" href="#asm.rules.preserved-registers">[asm.rules.preserved-registers]</a></div>
<ul>
<li>These flags registers must be restored upon exiting the asm block if the <code class="hljs">preserves_flags</code> option is set:
<ul>
<li>x86
<ul>
<li>Status flags in <code class="hljs">EFLAGS</code> (CF, PF, AF, ZF, SF, OF).</li>
<li>Floating-point status word (all).</li>
<li>Floating-point exception flags in <code class="hljs">MXCSR</code> (PE, UE, OE, ZE, DE, IE).</li>
</ul>
</li>
<li>ARM
<ul>
<li>Condition flags in <code class="hljs">CPSR</code> (N, Z, C, V)</li>
<li>Saturation flag in <code class="hljs">CPSR</code> (Q)</li>
<li>Greater than or equal flags in <code class="hljs">CPSR</code> (GE).</li>
<li>Condition flags in <code class="hljs">FPSCR</code> (N, Z, C, V)</li>
<li>Saturation flag in <code class="hljs">FPSCR</code> (QC)</li>
<li>Floating-point exception flags in <code class="hljs">FPSCR</code> (IDC, IXC, UFC, OFC, DZC, IOC).</li>
</ul>
</li>
<li>AArch64
<ul>
<li>Condition flags (<code class="hljs">NZCV</code> register).</li>
<li>Floating-point status (<code class="hljs">FPSR</code> register).</li>
</ul>
</li>
<li>RISC-V
<ul>
<li>Floating-point exception flags in <code class="hljs">fcsr</code> (<code class="hljs">fflags</code>).</li>
<li>Vector extension state (<code class="hljs">vtype</code>, <code class="hljs">vl</code>, <code class="hljs">vcsr</code>).</li>
</ul>
</li>
<li>LoongArch
<ul>
<li>Floating-point condition flags in <code class="hljs">$fcc[0-7]</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.x86-df"><a class="rule-link" href="#asm.rules.x86-df">[asm.rules.x86-df]</a></div>
<ul>
<li>On x86, the direction flag (DF in <code class="hljs">EFLAGS</code>) is clear on entry to an asm block and must be clear on exit.
<ul>
<li>Behavior is undefined if the direction flag is set on exiting an asm block.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.x86-x87"><a class="rule-link" href="#asm.rules.x86-x87">[asm.rules.x86-x87]</a></div>
<ul>
<li>On x86, the x87 floating-point register stack must remain unchanged unless all of the <code class="hljs">st([0-7])</code> registers have been marked as clobbered with <code class="hljs">out("st(0)") _, out("st(1)") _, ...</code>.
<ul>
<li>If all x87 registers are clobbered then the x87 register stack is guaranteed to be empty upon entering an <code class="hljs">asm</code> block. Assembly code must ensure that the x87 register stack is also empty when exiting the asm block.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.only-on-exit"><a class="rule-link" href="#asm.rules.only-on-exit">[asm.rules.only-on-exit]</a></div>
<ul>
<li>The requirement of restoring the stack pointer and non-output registers to their original value only applies when exiting an <code class="hljs">asm!</code> block.
<ul>
<li>This means that <code class="hljs">asm!</code> blocks that never return (even if not marked <code class="hljs">noreturn</code>) donâ€™t need to preserve these registers.</li>
<li>When returning to a different <code class="hljs">asm!</code> block than you entered (e.g. for context switching), these registers must contain the value they had upon entering the <code class="hljs">asm!</code> block that you are <em>exiting</em>.
<ul>
<li>You cannot exit an <code class="hljs">asm!</code> block that has not been entered.
Neither can you exit an <code class="hljs">asm!</code> block that has already been exited (without first entering it again).</li>
<li>You are responsible for switching any target-specific state (e.g. thread-local storage, stack bounds).</li>
<li>You cannot jump from an address in one <code class="hljs">asm!</code> block to an address in another, even within the same function or block, without treating their contexts as potentially different and requiring context switching. You cannot assume that any particular value in those contexts (e.g. current stack pointer or temporary values below the stack pointer) will remain unchanged between the two <code class="hljs">asm!</code> blocks.</li>
<li>The set of memory locations that you may access is the intersection of those allowed by the <code class="hljs">asm!</code> blocks you entered and exited.</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.not-successive"><a class="rule-link" href="#asm.rules.not-successive">[asm.rules.not-successive]</a></div>
<ul>
<li>You cannot assume that two <code class="hljs">asm!</code> blocks adjacent in source code, even without any other code between them, will end up in successive addresses in the binary without any other instructions between them.</li>
</ul>
<div class="rule" id="asm.rules.not-exactly-once"><a class="rule-link" href="#asm.rules.not-exactly-once">[asm.rules.not-exactly-once]</a></div>
<ul>
<li>You cannot assume that an <code class="hljs">asm!</code> block will appear exactly once in the output binary.
The compiler is allowed to instantiate multiple copies of the <code class="hljs">asm!</code> block, for example when the function containing it is inlined in multiple places.</li>
</ul>
<div class="rule" id="asm.rules.x86-prefix-restriction"><a class="rule-link" href="#asm.rules.x86-prefix-restriction">[asm.rules.x86-prefix-restriction]</a></div>
<ul>
<li>On x86, inline assembly must not end with an instruction prefix (such as <code class="hljs">LOCK</code>) that would apply to instructions generated by the compiler.
<ul>
<li>The compiler is currently unable to detect this due to the way inline assembly is compiled, but may catch and reject this in the future.</li>
</ul>
</li>
</ul>
<div class="rule" id="asm.rules.preserves_flags"><a class="rule-link" href="#asm.rules.preserves_flags">[asm.rules.preserves_flags]</a></div>
<blockquote>
<p><strong>Note</strong>: As a general rule, the flags covered by <code class="hljs">preserves_flags</code> are those which are <em>not</em> preserved when performing a function call.</p>
</blockquote>
<h3 id="correctness-and-validity"><a class="header" href="#correctness-and-validity">Correctness and Validity</a></h3>
<div class="rule" id="asm.validity"><a class="rule-link" href="#asm.validity">[asm.validity]</a></div>
<div class="rule" id="asm.validity.necessary-but-not-sufficient"><a class="rule-link" href="#asm.validity.necessary-but-not-sufficient">[asm.validity.necessary-but-not-sufficient]</a></div>
<p>In addition to all of the previous rules, the string argument to <code class="hljs">asm!</code> must ultimately becomeâ€”
after all other arguments are evaluated, formatting is performed, and operands are translatedâ€”
assembly that is both syntactically correct and semantically valid for the target architecture.
The formatting rules allow the compiler to generate assembly with correct syntax.
Rules concerning operands permit valid translation of Rust operands into and out of <code class="hljs">asm!</code>.
Adherence to these rules is necessary, but not sufficient, for the final expanded assembly to be
both correct and valid. For instance:</p>
<ul>
<li>arguments may be placed in positions which are syntactically incorrect after formatting</li>
<li>an instruction may be correctly written, but given architecturally invalid operands</li>
<li>an architecturally unspecified instruction may be assembled into unspecified code</li>
<li>a set of instructions, each correct and valid, may cause undefined behavior if placed in immediate succession</li>
</ul>
<div class="rule" id="asm.validity.non-exhaustive"><a class="rule-link" href="#asm.validity.non-exhaustive">[asm.validity.non-exhaustive]</a></div>
<p>As a result, these rules are <em>non-exhaustive</em>. The compiler is not required to check the
correctness and validity of the initial string nor the final assembly that is generated.
The assembler may check for correctness and validity but is not required to do so.
When using <code class="hljs">asm!</code>, a typographical error may be sufficient to make a program unsound,
and the rules for assembly may include thousands of pages of architectural reference manuals.
Programmers should exercise appropriate care, as invoking this <code class="hljs">unsafe</code> capability comes with
assuming the responsibility of not violating rules of both the compiler or the architecture.</p>
<h3 id="directives-support"><a class="header" href="#directives-support">Directives Support</a></h3>
<div class="rule" id="asm.directives"><a class="rule-link" href="#asm.directives">[asm.directives]</a></div>
<div class="rule" id="asm.directives.subset-supported"><a class="rule-link" href="#asm.directives.subset-supported">[asm.directives.subset-supported]</a></div>
<p>Inline assembly supports a subset of the directives supported by both GNU AS and LLVMâ€™s internal assembler, given as follows.
The result of using other directives is assembler-specific (and may cause an error, or may be accepted as-is).</p>
<div class="rule" id="asm.directives.stateful"><a class="rule-link" href="#asm.directives.stateful">[asm.directives.stateful]</a></div>
<p>If inline assembly includes any â€œstatefulâ€ directive that modifies how subsequent assembly is processed, the block must undo the effects of any such directives before the inline assembly ends.</p>
<div class="rule" id="asm.directives.supported-directives"><a class="rule-link" href="#asm.directives.supported-directives">[asm.directives.supported-directives]</a></div>
<p>The following directives are guaranteed to be supported by the assembler:</p>
<ul>
<li><code class="hljs">.2byte</code></li>
<li><code class="hljs">.4byte</code></li>
<li><code class="hljs">.8byte</code></li>
<li><code class="hljs">.align</code></li>
<li><code class="hljs">.alt_entry</code></li>
<li><code class="hljs">.ascii</code></li>
<li><code class="hljs">.asciz</code></li>
<li><code class="hljs">.balign</code></li>
<li><code class="hljs">.balignl</code></li>
<li><code class="hljs">.balignw</code></li>
<li><code class="hljs">.bss</code></li>
<li><code class="hljs">.byte</code></li>
<li><code class="hljs">.comm</code></li>
<li><code class="hljs">.data</code></li>
<li><code class="hljs">.def</code></li>
<li><code class="hljs">.double</code></li>
<li><code class="hljs">.endef</code></li>
<li><code class="hljs">.equ</code></li>
<li><code class="hljs">.equiv</code></li>
<li><code class="hljs">.eqv</code></li>
<li><code class="hljs">.fill</code></li>
<li><code class="hljs">.float</code></li>
<li><code class="hljs">.global</code></li>
<li><code class="hljs">.globl</code></li>
<li><code class="hljs">.inst</code></li>
<li><code class="hljs">.insn</code></li>
<li><code class="hljs">.lcomm</code></li>
<li><code class="hljs">.long</code></li>
<li><code class="hljs">.octa</code></li>
<li><code class="hljs">.option</code></li>
<li><code class="hljs">.p2align</code></li>
<li><code class="hljs">.popsection</code></li>
<li><code class="hljs">.private_extern</code></li>
<li><code class="hljs">.pushsection</code></li>
<li><code class="hljs">.quad</code></li>
<li><code class="hljs">.scl</code></li>
<li><code class="hljs">.section</code></li>
<li><code class="hljs">.set</code></li>
<li><code class="hljs">.short</code></li>
<li><code class="hljs">.size</code></li>
<li><code class="hljs">.skip</code></li>
<li><code class="hljs">.sleb128</code></li>
<li><code class="hljs">.space</code></li>
<li><code class="hljs">.string</code></li>
<li><code class="hljs">.text</code></li>
<li><code class="hljs">.type</code></li>
<li><code class="hljs">.uleb128</code></li>
<li><code class="hljs">.word</code></li>
</ul>
<h4 id="target-specific-directive-support"><a class="header" href="#target-specific-directive-support">Target Specific Directive Support</a></h4>
<div class="rule" id="asm.target-specific-directives"><a class="rule-link" href="#asm.target-specific-directives">[asm.target-specific-directives]</a></div>
<h5 id="dwarf-unwinding"><a class="header" href="#dwarf-unwinding">Dwarf Unwinding</a></h5>
<div class="rule" id="asm.target-specific-directives.dwarf-unwinding"><a class="rule-link" href="#asm.target-specific-directives.dwarf-unwinding">[asm.target-specific-directives.dwarf-unwinding]</a></div>
<p>The following directives are supported on ELF targets that support DWARF unwind info:</p>
<ul>
<li><code class="hljs">.cfi_adjust_cfa_offset</code></li>
<li><code class="hljs">.cfi_def_cfa</code></li>
<li><code class="hljs">.cfi_def_cfa_offset</code></li>
<li><code class="hljs">.cfi_def_cfa_register</code></li>
<li><code class="hljs">.cfi_endproc</code></li>
<li><code class="hljs">.cfi_escape</code></li>
<li><code class="hljs">.cfi_lsda</code></li>
<li><code class="hljs">.cfi_offset</code></li>
<li><code class="hljs">.cfi_personality</code></li>
<li><code class="hljs">.cfi_register</code></li>
<li><code class="hljs">.cfi_rel_offset</code></li>
<li><code class="hljs">.cfi_remember_state</code></li>
<li><code class="hljs">.cfi_restore</code></li>
<li><code class="hljs">.cfi_restore_state</code></li>
<li><code class="hljs">.cfi_return_column</code></li>
<li><code class="hljs">.cfi_same_value</code></li>
<li><code class="hljs">.cfi_sections</code></li>
<li><code class="hljs">.cfi_signal_frame</code></li>
<li><code class="hljs">.cfi_startproc</code></li>
<li><code class="hljs">.cfi_undefined</code></li>
<li><code class="hljs">.cfi_window_save</code></li>
</ul>
<h5 id="structured-exception-handling"><a class="header" href="#structured-exception-handling">Structured Exception Handling</a></h5>
<div class="rule" id="asm.target-specific-directives.structured-exception-handling"><a class="rule-link" href="#asm.target-specific-directives.structured-exception-handling">[asm.target-specific-directives.structured-exception-handling]</a></div>
<p>On targets with structured exception Handling, the following additional directives are guaranteed to be supported:</p>
<ul>
<li><code class="hljs">.seh_endproc</code></li>
<li><code class="hljs">.seh_endprologue</code></li>
<li><code class="hljs">.seh_proc</code></li>
<li><code class="hljs">.seh_pushreg</code></li>
<li><code class="hljs">.seh_savereg</code></li>
<li><code class="hljs">.seh_setframe</code></li>
<li><code class="hljs">.seh_stackalloc</code></li>
</ul>
<h5 id="x86-32-bit-and-64-bit"><a class="header" href="#x86-32-bit-and-64-bit">x86 (32-bit and 64-bit)</a></h5>
<div class="rule" id="asm.target-specific-directives.x86"><a class="rule-link" href="#asm.target-specific-directives.x86">[asm.target-specific-directives.x86]</a></div>
<p>On x86 targets, both 32-bit and 64-bit, the following additional directives are guaranteed to be supported:</p>
<ul>
<li><code class="hljs">.nops</code></li>
<li><code class="hljs">.code16</code></li>
<li><code class="hljs">.code32</code></li>
<li><code class="hljs">.code64</code></li>
</ul>
<p>Use of <code class="hljs">.code16</code>, <code class="hljs">.code32</code>, and <code class="hljs">.code64</code> directives are only supported if the state is reset to the default before exiting the assembly block.
32-bit x86 uses <code class="hljs">.code32</code> by default, and x86_64 uses <code class="hljs">.code64</code> by default.</p>
<h5 id="arm-32-bit"><a class="header" href="#arm-32-bit">ARM (32-bit)</a></h5>
<div class="rule" id="asm.target-specific-directives.arm-32-bit"><a class="rule-link" href="#asm.target-specific-directives.arm-32-bit">[asm.target-specific-directives.arm-32-bit]</a></div>
<p>On ARM, the following additional directives are guaranteed to be supported:</p>
<ul>
<li><code class="hljs">.even</code></li>
<li><code class="hljs">.fnstart</code></li>
<li><code class="hljs">.fnend</code></li>
<li><code class="hljs">.save</code></li>
<li><code class="hljs">.movsp</code></li>
<li><code class="hljs">.code</code></li>
<li><code class="hljs">.thumb</code></li>
<li><code class="hljs">.thumb_func</code></li>
</ul>

                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                        <a rel="prev" href="linkage.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                            <i class="fa fa-angle-left"></i>
                        </a>

                        <a rel="next prefetch" href="unsafety.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                            <i class="fa fa-angle-right"></i>
                        </a>

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
                <a rel="prev" href="linkage.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                    <i class="fa fa-angle-left"></i>
                </a>

                <a rel="next prefetch" href="unsafety.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                    <i class="fa fa-angle-right"></i>
                </a>
        </nav>

    </div>




    <script>
        window.playground_copyable = true;
    </script>


    <script src="elasticlunr.min.js"></script>
    <script src="mark.min.js"></script>
    <script src="searcher.js"></script>

    <script src="clipboard.min.js"></script>
    <script src="highlight.js"></script>
    <script src="book.js"></script>

    <!-- Custom JS scripts -->


</div>


</body></html>